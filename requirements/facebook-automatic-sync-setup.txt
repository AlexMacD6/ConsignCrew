# Facebook Automatic Catalog Sync Setup

## Overview
Implemented automatic Facebook catalog sync that triggers whenever listings are created, updated, or deleted. No more manual button pushing!

## What Was Implemented

### 1. **Facebook Catalog Sync Service** (`app/lib/facebook-catalog-sync.ts`)
- **Automatic sync functions** for create, update, and delete operations
- **Error handling** that won't break your main app if sync fails
- **Batch sync capability** for multiple listings
- **Database tracking** of sync status and Facebook catalog IDs

### 2. **Database Schema Updates**
Added new fields to the Listing model:
- `facebookCatalogId`: Stores Facebook's catalog product ID
- `lastFacebookSync`: Tracks when the listing was last synced

### 3. **Automatic Integration Points**
- **Listing Creation**: Automatically syncs new listings to Facebook
- **Listing Updates**: Automatically syncs changes (price, status, etc.) to Facebook
- **Error Resilience**: Sync failures don't break listing operations

## Required Environment Variables

Add these to your Vercel environment variables:

```env
# Facebook API Configuration
FACEBOOK_ACCESS_TOKEN=your_facebook_access_token_here
FACEBOOK_CATALOG_ID=1292185629315792
NEXT_PUBLIC_APP_URL=https://treasurehub.club
```

## How It Works

### **Automatic Triggers**
1. **Create Listing** → Automatically creates product in Facebook catalog
2. **Update Listing** → Automatically updates product in Facebook catalog
3. **Delete Listing** → Automatically removes product from Facebook catalog

### **Sync Flow**
```
Your Database → Facebook Sync Service → Facebook API → Facebook Catalog → Facebook Shop
```

### **Error Handling**
- **Sync failures** are logged but don't break listing operations
- **Retry logic** can be added later if needed
- **Status tracking** shows which listings have sync issues

## Benefits

✅ **No manual intervention** - everything happens automatically  
✅ **Real-time updates** - Facebook shop always shows current inventory  
✅ **Consistent data** - Facebook catalog matches your database exactly  
✅ **Better user experience** - seamless integration between platforms  

## Testing

### **Test New Listing Creation**
1. Create a new listing in your app
2. Check console logs for Facebook sync messages
3. Verify the listing appears in your Facebook catalog

### **Test Listing Updates**
1. Edit an existing listing (change price, status, etc.)
2. Check console logs for Facebook sync messages
3. Verify changes appear in Facebook catalog

### **Test Error Handling**
1. Temporarily break Facebook API (wrong token, etc.)
2. Create/update a listing
3. Verify the listing operation still succeeds
4. Check logs for sync failure messages

## Next Steps

### **Immediate**
1. **Add environment variables** to Vercel
2. **Test with a new listing** to verify sync works
3. **Check Facebook catalog** for new products

### **Future Enhancements**
1. **Sync status dashboard** in admin panel
2. **Retry failed syncs** automatically
3. **Batch sync optimization** for multiple changes
4. **Sync conflict resolution** for edge cases

## Troubleshooting

### **Common Issues**
1. **"Invalid token" errors** - Check FACEBOOK_ACCESS_TOKEN
2. **"Catalog not found" errors** - Check FACEBOOK_CATALOG_ID
3. **Sync not triggering** - Verify facebookShopEnabled is true

### **Debug Steps**
1. **Check console logs** for sync messages
2. **Verify environment variables** are set correctly
3. **Test Facebook API** directly with your token
4. **Check listing.facebookShopEnabled** field

## Expected Result
Your Facebook shop will now automatically stay in sync with your database without any manual intervention!

