# Requirements: Remove S3 Stored Tag and Fix Price Drop Logic

## Original Request
- Remove the "S3 Stored" tag from the image carousel
- Fix the price drop calculation to be exactly 7 days from the listing creation date (not based on discount schedule intervals)

## Changes Made

### 1. S3 Stored Tag Removal
- **File**: `app/components/RobustImage.tsx`
- **Change**: Removed the "S3 Stored" indicator div that was displayed on S3-stored images
- **Result**: Clean image display without unnecessary tags

### 2. Price Drop Calculation Fix
- **File**: `app/(dashboard)/listings/page.tsx`
- **Change**: Updated `getTimeUntilNextDrop` function to calculate exactly 7 days from listing creation date
- **Logic**: 
  - Removed complex discount schedule logic
  - Simple calculation: `created.getTime() + 7 * 24 * 60 * 60 * 1000`
  - Returns both formatted string and raw milliseconds for precise time checks

### 3. Price Drop Display Refinement
- **File**: `app/(dashboard)/listings/page.tsx`
- **Change**: Modified red price drop badge to only show when within 24 hours
- **Logic**: Only displays if `nextDrop.raw <= 24 * 60 * 60 * 1000`
- **Removed**: Gray "Next Price Drop:" text from listing modal

### 4. Status Field Fix
- **File**: `app/(dashboard)/listings/page.tsx`
- **Change**: Updated `getStatusBadge` function to return "Available" for active/listed statuses
- **Icon**: Replaced emoji with consistent Lucide `CheckCircle` icon
- **Result**: Status field now properly displays "Available" with green badge

### 5. Image Order Fix
- **File**: `app/(dashboard)/listings/page.tsx`
- **Change**: Modified `all_images` array construction to match list-item page order
- **Order**: Hero → Proof (DALL-E) → Back → Additional photos
- **Result**: Consistent image ordering across main listings and detail pages

### 6. Edit Listing Page Photo Management
- **File**: `app/(dashboard)/list-item/[id]/edit/page.tsx`
- **Changes**:
  - **NEW FEATURES**:
    - Photo naming with sequence numbers and titles (e.g., "3. Hero" instead of filenames)
    - Enhanced photo management UI integrated within Photos section

### 8. Price Drop Timer Fix (History Component)
- **File**: `app/api/listings/[id]/next-price-drop/route.ts`
- **Change**: Removed complex discount schedule logic, implemented simple 7-day calculation
- **File**: `app/(dashboard)/list-item/[id]/page.tsx`
- **Change**: Updated `getTimeUntilNextDrop` function to match simple 7-day logic
- **Result**: Timer no longer resets on page reload, correctly shows 7 days from creation



## Technical Details

### Price Drop Logic
```typescript
const nextDropTime = new Date(created.getTime() + 7 * 24 * 60 * 60 * 1000); // 7 days from creation
```



### Photo Naming Logic
```typescript
// Example: "3. Hero" instead of "13242-242.jpg"
{index + 1}. {photoTitle}
```

## Testing Instructions

1. **S3 Tag Removal**: Verify no "S3 Stored" tags appear on images in carousel
2. **Price Drop Calculation**: 
   - Create a new listing
   - Verify price drop timer shows exactly 7 days from creation
   - Check that red badge only appears within 24 hours
3. **Status Display**: Verify "Available" status appears for active listings
4. **Image Order**: Confirm DALL-E photo appears second on main listings page
5. **Edit Listing Page**:
   - Verify photo naming shows sequence numbers and titles
   - Confirm enhanced photo management UI is working

## Files Modified
- `app/components/RobustImage.tsx`
- `app/(dashboard)/list-item/[id]/edit/page.tsx`

- `app/api/listings/[id]/next-price-drop/route.ts`
- `app/(dashboard)/list-item/[id]/page.tsx`
- `app/api/listings/[id]/route.ts`
- `requirements/remove-s3-tag-fix-price-drop.txt`
 